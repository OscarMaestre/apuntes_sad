<!DOCTYPE html>
<html class="writer-html5" lang="es" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Implantación de soluciones de alta disponibilidad &mdash; documentación de Apuntes de Seguridad y alta disponibilidad - 1.0</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" />
    <link rel="next" title="Instalación y configuración de servidores proxy" href="../tema_proxys/tema_proxys.html" />
    <link rel="prev" title="Instalación y configuración de cortafuegos" href="../tema_cortafuegos/tema_cortafuegos.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Apuntes de Seguridad y alta disponibilidad
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Buscar documentos" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contenidos:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tema_pautas_seguridad_informatica/tema_pautas_seguridad_informatica.html">Adopción de pautas de seguridad informática</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tema_cortafuegos/tema_cortafuegos.html">Instalación y configuración de cortafuegos</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Implantación de soluciones de alta disponibilidad</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#definicion-y-objetivos">Definición y objetivos.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#virtualizacion-de-sistemas">Virtualización de sistemas.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#modos-de-red-en-virtualbox">Modos de red en VirtualBox</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#posibilidades-de-la-virtualizacion-de-sistemas">Posibilidades de la virtualización de sistemas.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#herramientas-para-la-virtualizacion">Herramientas para la virtualización.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuracion-y-utilizacion-de-maquinas-virtuales">Configuración y utilización de maquinas virtuales.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#alta-disponibilidad-y-virtualizacion">Alta disponibilidad y virtualización.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#el-fichero-vagrantfile">El fichero <code class="docutils literal notranslate"><span class="pre">Vagrantfile</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#simulacion-de-servicios-con-virtualizacion">Simulación de servicios con virtualización.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#analisis-de-configuraciones-de-alta-disponibilidad">Análisis de configuraciones de alta disponibilidad</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hardware-duplicado">Hardware duplicado</a></li>
<li class="toctree-l3"><a class="reference internal" href="#virtualizacion">Virtualización</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#docker">Docker</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#contenedores">Contenedores</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#imagenes-y-procesos-docker">Imágenes y procesos Docker</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#gestion-de-contenedores">Gestión de contenedores</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#los-elementos-basicos-de-docker">Los elementos básicos de Docker</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#la-consola-y-los-contenedores">La consola y los contenedores</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gestion-de-imagenes">Gestión de imágenes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#instalando-docker">Instalando Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conexiones-de-red-en-docker">Conexiones de red en Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creando-nuestra-propia-red-en-docker">Creando nuestra propia red en Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ejercicios-de-redes-docker">Ejercicios de redes Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#almacenamiento-con-docker">Almacenamiento con Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#montaje-de-directorios">Montaje de directorios</a></li>
<li class="toctree-l3"><a class="reference internal" href="#un-ejemplo-simple-de-docker">Un ejemplo simple de Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#un-ejemplo-mas-avanzado-de-docker-usando-mysql">Un ejemplo más avanzado de Docker usando MySQL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#funcionamiento-ininterrumpido">Funcionamiento ininterrumpido.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#integridad-de-datos-y-recuperacion-de-servicio">Integridad de datos y recuperación de servicio.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#servidores-redundantes">Servidores redundantes.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sistemas-de-clusters">Sistemas de  clusters.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#san-nas-fiberchannel">SAN, NAS, FiberChannel</a></li>
<li class="toctree-l2"><a class="reference internal" href="#balanceadores-de-carga">Balanceadores de carga.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#instalacion-y-configuracion-de-soluciones-de-alta-disponibilidad">Instalación y configuración de soluciones de alta disponibilidad.</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#ejercicio-recuperando-una-web-con-vagrant">Ejercicio: recuperando una web con Vagrant</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#solucion-a-la-recuperacion-de-la-web">Solución a la recuperación de la web</a></li>
<li class="toctree-l2"><a class="reference internal" href="#solucion-al-ejercicio-de-alojar-una-base-de-datos-en-docker">Solución al ejercicio de alojar una base de datos en Docker</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tema_proxys/tema_proxys.html">Instalación y configuración de servidores  proxy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tema_lopd/tema_lopd.html">Legislación y normas sobre seguridad</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tema_acceso_remoto/tema_acceso_remoto.html">Implantación de técnicas de acceso remoto. Seguridad perimetral</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Apuntes de Seguridad y alta disponibilidad</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Implantación de soluciones de alta disponibilidad</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tema_sad/tema_sad.rst.txt" rel="nofollow"> Ver código fuente de la página</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="implantacion-de-soluciones-de-alta-disponibilidad">
<h1>Implantación de soluciones de alta disponibilidad<a class="headerlink" href="#implantacion-de-soluciones-de-alta-disponibilidad" title="Enlazar permanentemente con este título"></a></h1>
<section id="definicion-y-objetivos">
<h2>Definición y objetivos.<a class="headerlink" href="#definicion-y-objetivos" title="Enlazar permanentemente con este título"></a></h2>
<p>En el tema «Pautas de seguridad informática» definíamos disponibilidad  de la siguiente manera: <em>capacidad de respuesta a una peticiones con las mínimas pausas por causas involuntarias</em> .</p>
<p>También decíamos que se mide la disponibilidad de un SI en «nueves».</p>
<ul class="simple">
<li><p>Se dice que un SI ofrece una disponibilidad de «2 nueves», si está disponible el 99% del tiempo.</p></li>
<li><p>Se dice que un SI ofrece una disponibilidad de «3 nueves», si lo está al 99.9%.</p></li>
<li><p>Se dice que un SI ofrece una disponibilidad de «4 nueves» si lo está al 99.99%.</p></li>
<li><p>Se dice que un SI ofrece una disponibilidad de «5 nueves» si lo está al 99.999%</p></li>
</ul>
<p>Evidentemente lograr una disponibilidad del 100% es imposible pero en este bloque analizaremos como lograr la máxima disponibilidad en un entorno informático.</p>
</section>
<section id="virtualizacion-de-sistemas">
<h2>Virtualización de sistemas.<a class="headerlink" href="#virtualizacion-de-sistemas" title="Enlazar permanentemente con este título"></a></h2>
<p>Muchos sistemas operativos que tengan que trabajar como invitados pueden beneficiarse de ciertas posibilidades instalando un software que VirtualBox llama «Guest additions».</p>
<p>Las «Guest additions» («añadidos para el sistema operativo invitado») son un conjunto de drivers y programas que mejoran la experiencia de uso y el rendimiento de los sistemas operativos invitados. En general, es buena idea instalarlas ya que ofrecen:</p>
<ul class="simple">
<li><p>Mejor soporte para el ratón, tarjeta de vídeo y comunicación entre el anfitrión  el invitado.</p></li>
<li><p>Capacidad para compartir carpetas entre el anfitrión y el invitado.</p></li>
<li><p>Mejor sincronización de la hora entre anfitrión e invitado.</p></li>
<li><p>Posibilidad de compartir datos entre el portapapeles del anfitrión e invitado.</p></li>
<li><p>Inicio de sesión automático.</p></li>
</ul>
<section id="modos-de-red-en-virtualbox">
<h3>Modos de red en VirtualBox<a class="headerlink" href="#modos-de-red-en-virtualbox" title="Enlazar permanentemente con este título"></a></h3>
<p>A la hora de virtualizar un servicio es importante elegir correctamente el modo de funcionamiento del subsistema de red, ya que cada uno de ellos tiene sus ventajas e inconvenientes. En concreto VirtualBox ofrece los siguientes modos:</p>
<ul class="simple">
<li><p>No conectado.</p></li>
<li><p>NAT: Network Address Translation es el proceso por el cual una máquina intercepta las peticiones de red de otra y las efectúa en su lugar (sustituyendo la IP). Cuando llega la respuesta, la máquina interceptora modifica esa respuesta para que la IP de destino sea la de la máquina interceptada. En el caso de VirtualBox el modo NAT hace que el programa VirtualBox “intercepte” las peticiones que salen desde el SO “invitado”. Si algún ordenador de fuera desea iniciar una conexión hacia el SO invitado, VirtualBox prohibirá dicha conexión. Será necesario abrir puertos.</p></li>
<li><p>Red NAT: Facilita la creación de servidores protegidos detrás de un servicio NAT. Supongamos que queremos un servidor HTTP y uno FTP. Podríamos ponerlos en dos máquinas virtuales cada una con su NAT. Pero esto implicaría «tratar a las máquinas por separado». Creando una red NAT podemos simplificar un poco la apertura de puertos trabajando con una sola red NAT. De alguna manera esto implica poder fabricar grupos de máquinas virtuales gestionados por la misma red NAT,son máquinas que compartirán ese «router firewall NAT» virtual.</p></li>
<li><p>Bridge/adaptador puente: el SO invitado no tendrá ninguna restricción y se portará como uno más de la red. El SO invitado necesitará su propia IP separada y distinta del anfitrión.</p></li>
<li><p>Red interna: En este modo podemos crear «redes ficticias que no se ven desde fuera del anfitrión». Consiste en crear redes con un cierto nombre y los distintos invitados que estén asociados a esa «red ficticia» podrán verse entre sí  pero no podrán salir al exterior.</p></li>
<li><p>Solo anfitrión: el invitado solo “ve” a otras máquinas en modo «host-only» que estén en el mismo anfitrión. Para ir más lejos, y esto implica incluso contactar con el anfitrión, es necesario poner algún enrutamiento: por ejemplo, otra máquina más con dos tarjetas, una en modo «solo anfitrión» y por ejemplo con la otra en modo «puente» y activar el enrutamiento.</p></li>
<li><p>Red genérica: solo se usará cuando virtualicemos sistemas operativos que no tengan drivers para alguna de las tarjetas</p></li>
</ul>
<p>En la figura siguiente, sacada de la web de VirtualBox se ilustra «quien puede ver a quien»</p>
<figure class="align-default" id="id3">
<a class="reference internal image-reference" href="../_images/modos_virtual_box.png"><img alt="Hooks" src="../_images/modos_virtual_box.png" style="width: 802.4000000000001px; height: 200.0px;" /></a>
<figcaption>
<p><span class="caption-text">Modos de red en VirtualBox</span><a class="headerlink" href="#id3" title="Enlace permanente a esta imagen"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="posibilidades-de-la-virtualizacion-de-sistemas">
<h2>Posibilidades de la virtualización de sistemas.<a class="headerlink" href="#posibilidades-de-la-virtualizacion-de-sistemas" title="Enlazar permanentemente con este título"></a></h2>
<ul class="simple">
<li><p>Posibilidad de mover entornos a distintos lugares (remotos o no)</p></li>
<li><p>Facilidad de recuperación de un entorno corrupto.</p></li>
<li><p>Fácil replicación de entornos.</p></li>
</ul>
</section>
<section id="herramientas-para-la-virtualizacion">
<h2>Herramientas para la virtualización.<a class="headerlink" href="#herramientas-para-la-virtualizacion" title="Enlazar permanentemente con este título"></a></h2>
<ul class="simple">
<li><p>VirtualBox</p></li>
<li><p>VMWare</p></li>
</ul>
<p>Y para gestionar la virtualización tenemos:</p>
<ul class="simple">
<li><p>Vagrant</p></li>
<li><p>Docker</p></li>
<li><p>Kubernetes</p></li>
</ul>
</section>
<section id="configuracion-y-utilizacion-de-maquinas-virtuales">
<h2>Configuración y utilización de maquinas virtuales.<a class="headerlink" href="#configuracion-y-utilizacion-de-maquinas-virtuales" title="Enlazar permanentemente con este título"></a></h2>
<p>Durante el primer curso ya se ha explicado el funcionamiento básico de este software por lo que aquí no volveremos a repetir lo ya visto.</p>
</section>
<section id="alta-disponibilidad-y-virtualizacion">
<h2>Alta disponibilidad y virtualización.<a class="headerlink" href="#alta-disponibilidad-y-virtualizacion" title="Enlazar permanentemente con este título"></a></h2>
<p>En pocas palabras podemos reconstruir un sistema virtualizado previamente usando solo estos comandos:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vagrant</span> <span class="pre">init</span> <span class="pre">maquina/usr</span></code> : Inicializa un directorio con la configuración de esa máquina (cuidado, en Windows hay que cambiar y en lugar de escribir cosas como <code class="docutils literal notranslate"><span class="pre">vagrant</span> <span class="pre">init</span> <span class="pre">d:\directorio\maquina.box</span></code> usar <code class="docutils literal notranslate"><span class="pre">vagrant</span> <span class="pre">init</span> <span class="pre">d:/directorio/maquina.box</span></code>, es decir cambiar la barra por la /).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vagrant</span> <span class="pre">up</span></code> : «Levanta» la máquina, instalándola, recuperando su estado tal y como se hubiera quedado y configurándola desde cero. Por defecto, las máquinas suelen tener el usuario «vagrant» con la clave «vagrant».</p></li>
</ul>
<p>Para «exportar» nuestra máquina y facilitar su gestión con Vagrant se debe:</p>
<ul>
<li><p>Instalar un sistema operativo invitado como Windows 7 o superior o alguna variante de Linux.</p></li>
<li><p>Al principio como mínimo se debe tener una tarjeta en modo NAT y además se debe anotar la MAC de dicha tarjeta.</p></li>
<li><p>Si estamos en Linux se deben haber instalado los elementos que permiten añadir módulos al núcleo del sistema con <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">linux-headers-$(uname</span> <span class="pre">-r)</span> <span class="pre">build-essential</span> <span class="pre">dkms</span></code></p></li>
<li><p>Se deben instalar las «Guest Additions» en el anfitrión.</p></li>
<li><p>Se debe instalar OpenSSH con <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">openssh-server</span></code>.</p></li>
<li><p>Es recomendable crear el usuario «vagrant» y ponerle la clave Vagrant. También es importante permitir que ese usuario pueda ser administrador y que además no necesite indicar su clave de administrador cada vez. Esto puede hacerse editando los parámetros de administración con <code class="docutils literal notranslate"><span class="pre">visudo</span></code> y poniendo la línea <code class="docutils literal notranslate"><span class="pre">vagrant</span> <span class="pre">ALL=(ALL)</span> <span class="pre">NOPASSWD:</span> <span class="pre">ALL</span></code>. En concreto y leyendo palabra a palabra esto significa que:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>vagrant</strong> ALL=(ALL) NOPASSWD: ALL (La regla se aplica al usuario vagrant)</p></li>
<li><p>vagrant <strong>ALL</strong> =(ALL) NOPASSWD: ALL (La regla se aplica a todos los host)</p></li>
<li><p>vagrant ALL= <strong>(ALL)</strong> NOPASSWD: ALL (vagrant puede ejecutar algo como si fuese cualquier usuario)</p></li>
<li><p>vagrant ALL=(ALL) <strong>NOPASSWD</strong>: ALL (no se necesita indicar contraseña</p></li>
<li><p>vagrant ALL=(ALL) NOPASSWD: <strong>ALL</strong> (puede ejecutar cualquier comando)</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Se debe iniciar sesión en la máquina virtual con el usuario «vagrant» y la clave «vagrant». Nos conectaremos a nuestra propia máquina con <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">localhost</span></code> y despues nos salimos (eso permite que se cree el directorio .ssh).  Se debe meter la clave pública de Vagrant dentro del directorio ssh con <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">vagrant.pub</span> <span class="pre">&gt;</span> <span class="pre">.ssh/authorized_keys</span></code> . Las claves públicas de <em>Vagrant</em>  pueden encontrarse en (<a class="reference external" href="https://raw.githubusercontent.com/hashicorp/vagrant/master/keys/vagrant.pub)[https://raw.githubusercontent.com/hashicorp/vagrant/master/keys/vagrant.pub">https://raw.githubusercontent.com/hashicorp/vagrant/master/keys/vagrant.pub)[https://raw.githubusercontent.com/hashicorp/vagrant/master/keys/vagrant.pub</a>]</p></li>
<li><p>Vamos a hacer que solo el propietario pueda leer ese fichero y ese directorio de claves usando <code class="docutils literal notranslate"><span class="pre">chmod</span> <span class="pre">0700</span> <span class="pre">.ssh</span></code></p></li>
<li><p>Una vez hecho todo esto podemos apagar la máquina virtual, cerrar VirtualBox y abrir la línea de comandos y crear un directorio vacío. Dentro de él inicializaremos el directorio para que sea un directorio inicializado por Vagrant con el comando <code class="docutils literal notranslate"><span class="pre">vagrant</span> <span class="pre">init</span></code> y luego exportaremos la máquina con <code class="docutils literal notranslate"><span class="pre">vagrant</span> <span class="pre">package</span> <span class="pre">--base</span> <span class="pre">&lt;nombredemaquina&gt;</span> <span class="pre">--output</span> <span class="pre">Maquina.box</span></code> .</p></li>
</ul>
<section id="el-fichero-vagrantfile">
<h3>El fichero <code class="docutils literal notranslate"><span class="pre">Vagrantfile</span></code><a class="headerlink" href="#el-fichero-vagrantfile" title="Enlazar permanentemente con este título"></a></h3>
<p>Este fichero controla como se inicializará la máquina virtual y ofrece un completo script con parámetros comentados, mencionamos algunos de los más utilizados. Como curiosidad utiliza un lenguaje de programación llamado «Ruby».Cada línea del fichero configura algo y suele indicar distintos parámetros usando las comas como separador.</p>
<p>Por defecto, las máquinas virtuales tienen una sola tarjeta en modo «NAT». A menudo querremos «abrir puertos» y conseguir que alguien pueda conectarse a un servicio virtualizado. Para ello podemos editar la configuración y poner algo como esto:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="c1">#Esto hace que la tarjeta de red del invitado esté</span>
<span class="c1">#en modo NAT y que use DHCP para configurarse.</span>
<span class="c1">#Probablemente la dirección que se nos asigne sea</span>
<span class="c1">#algo como 10.0.2.15</span>
<span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;private_network&quot;</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="s2">&quot;dhcp&quot;</span>
<span class="c1">#Con esto conseguimos que cuando se conecte al 8000 del anfitrión</span>
<span class="c1">#en realidad se redirija la conexión al 80 del invitado</span>
<span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;forwarded_port&quot;</span><span class="p">,</span> <span class="ss">guest</span><span class="p">:</span><span class="mi">80</span><span class="p">,</span> <span class="ss">host</span><span class="p">:</span><span class="mi">8000</span>
<span class="c1">#Podemos también forzar a que el puerto se redija hacia un ip exacta</span>
<span class="c1">#de invitado o a una ip exacta de host</span>
<span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;forwarded_port&quot;</span><span class="p">,</span> <span class="ss">guest</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="ss">host</span><span class="p">:</span> <span class="mi">8080</span><span class="p">,</span> <span class="ss">host_ip</span><span class="p">:</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="ss">guest_ip</span><span class="p">:</span><span class="s2">&quot;10.0.2.15&quot;</span>
</pre></div>
</div>
<p>Pero podemos crear una máquina en modo puente poniendo en el <code class="docutils literal notranslate"><span class="pre">Vagrantfile</span></code> algo como esto que crea una tarjeta en modo puente asociada a la tarjeta <code class="docutils literal notranslate"><span class="pre">enp0s25</span></code> y luego obliga a que en cada arranque se configure la IP, la máscara y la puerta de enlace (obsérvese que ademas no usa <code class="docutils literal notranslate"><span class="pre">netplan</span></code> , aunque podría usarse si es necesario).</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;public_network&quot;</span><span class="p">,</span> <span class="ss">bridge</span><span class="p">:</span><span class="s2">&quot;enp0s25&quot;</span>
<span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&quot;shell&quot;</span><span class="p">,</span>
    <span class="ss">run</span><span class="p">:</span><span class="s2">&quot;always&quot;</span><span class="p">,</span>
    <span class="ss">inline</span><span class="p">:</span><span class="s2">&quot;ifconfig enp0s3 192.168.1.41 netmask 255.255.255.0; route add default gw 192.168.1.1&quot;</span>
</pre></div>
</div>
<p>Si estamos en Windows deberemos poner en <code class="docutils literal notranslate"><span class="pre">bridge</span></code> el nombre de la tarjeta de red a la que queramos vincular la máquina virtual. Probablemente en Windows el nombre del «bridge» o tarjeta de red sea algo como <em>«Conexión de área local»</em>  o  <em>«Conexión de área local 1»</em> .</p>
<p>También podemos hacer que una cierta máquina instale software en el momento de ser recuperada haciendo algo como esto</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&quot;shell&quot;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="o">&lt;&lt;-</span><span class="dl">SHELL</span>
<span class="sh">    apt-get update</span>
<span class="sh">    apt-get install -y apache2</span>
<span class="dl">SHELL</span>
</pre></div>
</div>
</section>
</section>
<section id="simulacion-de-servicios-con-virtualizacion">
<h2>Simulación de servicios con virtualización.<a class="headerlink" href="#simulacion-de-servicios-con-virtualizacion" title="Enlazar permanentemente con este título"></a></h2>
<p>A continuación explicamos como virtualizar un servidor web «oculto» detrás del NAT de VirtualBox.</p>
<ul class="simple">
<li><p>Una vez instalado el sistema operativo dentro de VirtualBox deberemos configurar la red de dicho sistema operativo.</p></li>
<li><p>Cuando estamos dentro de VirtualBox y con la tarjeta en modo NAT, VirtualBox se convierte en «router NAT» para sus invitados y les asigna una IP como 10.0.2.15/24 con gateway 10.0.2.2. Si nuestro invitado tiene la red en modo DHCP tomará esa IP aunque si queremos podemos modificarla.</p></li>
<li><p>Un sistema operativo que esté dentro de una red con NAT <strong>no puede recibir conexiones iniciadas en el exterior</strong> por lo que habrá que abrir puertos dentro de VirtualBox.</p></li>
<li><p>Para abrir puertos deberemos tener apagado el sistema operativo invitado.</p></li>
<li><p>Una vez apagado, nos vamos a la configuración de la máquina virtual y en la categoría «Red» veremos que con la tarjeta en modo NAT podemos abrir un menú «Avanzado» que ofrece un botón «Reenvío de puertos».</p></li>
<li><p>Si deseamos por ejemplo tener un servidor web seguro virtualizado podemos pedirle a VirtualBox que cuando alguien se conecte a la IP del anfitrión usando el puerto seguro redirija dicha conexión al sistema operativo invitado usando datos como los siguientes:</p></li>
</ul>
<figure class="align-center" id="id4">
<a class="reference internal image-reference" href="../_images/puertos_nat_vbox.png"><img alt="Apertura de puertos en VirtualBox en modo NAT" src="../_images/puertos_nat_vbox.png" style="width: 515.5px; height: 64.5px;" /></a>
<figcaption>
<p><span class="caption-text">Apertura de puertos en VirtualBox en modo NAT</span><a class="headerlink" href="#id4" title="Enlace permanente a esta imagen"></a></p>
</figcaption>
</figure>
</section>
<section id="analisis-de-configuraciones-de-alta-disponibilidad">
<h2>Análisis de configuraciones de alta disponibilidad<a class="headerlink" href="#analisis-de-configuraciones-de-alta-disponibilidad" title="Enlazar permanentemente con este título"></a></h2>
<p>Para lograr la máxima disponibilidad podemos recurrir a distintas técnicas:</p>
<ul class="simple">
<li><p>Hardware duplicado.</p></li>
<li><p>Virtualización.</p></li>
<li><p>Tecnologías de contenedores.</p></li>
</ul>
<section id="hardware-duplicado">
<h3>Hardware duplicado<a class="headerlink" href="#hardware-duplicado" title="Enlazar permanentemente con este título"></a></h3>
<p>Un determinado servicio, p. ej. de bases de datos, podría estar replicado en varios equipos distintos. Diversos SGBD pueden hacer que cualquier inserción o borrado se replique automáticamente en todas las copias. Si se produce algún fallo en algún equipo, el resto de equipos pueden «repartirse» la carga extra de trabajo y conseguir así que los datos no dejen de estar disponibles en ningún momento.</p>
<p>Entre las ventajas podemos contar con que el rendimiento es el mejor de todas las configuraciones. Dado que los servicios se ejecutan directamente sobre el hardware tenemos casi la total garantía de que la ejecución y procesado de datos se harán con la máxima eficiencia, al no haber ninguna capa intermedia como las que veremos en los apartados siguientes.</p>
<p>El inconveniente más destacado es el coste. El hardware de servidores suele tener un coste muy alto, el cual puede multiplicarse aún más si necesitamos aumentar el número de equipos.</p>
</section>
<section id="virtualizacion">
<h3>Virtualización<a class="headerlink" href="#virtualizacion" title="Enlazar permanentemente con este título"></a></h3>
<p>Programas como VirtualBox o VMWare permiten instalar un servicio dentro de un sistema operativo llamado «invitado». Esta «máquina virtual» puede copiarse y moverse con facilidad pero la tenemos en ejecución en un solo equipo. Si hay un problema de hardware podemos mover esta máquina virtual en poco tiempo y así lograr una alta disponibilidad.</p>
<p>La mayor ventaja es que ahorramos mucho. Podemos tener un solo servidor de gama alta ejecutando dicha máquina virtual. Si este equipo falla, podemos mover la máquina virtual a otro ordenador (aunque sea un poco menos potente) que permita cubrir las necesidades hasta que reparemos/sustituyamos el otro equipo.</p>
<p>El inconveniente es que en realidad estamos «ejecutando un sistema operativo dentro de otro sistema operativo» con la enorme pérdida de rendimiento que esto supone</p>
</section>
</section>
<section id="docker">
<h2>Docker<a class="headerlink" href="#docker" title="Enlazar permanentemente con este título"></a></h2>
<section id="contenedores">
<h3>Contenedores<a class="headerlink" href="#contenedores" title="Enlazar permanentemente con este título"></a></h3>
<p>Los contenedores son un software del sistema operativo capaz de «encerrar y aislar otros programas o ficheros», consiguiendo que la ejecución de los mismos sea muy segura pero sin necesitar otro sistema operativo. Además los contenedores son programables mediante scripts lo que nos facilita mucho la tarea de desplegar servicios sin necesidad de perder rendimiento. La comparación entre arquitecturas es la siguiente (imagen tomada de la web de Docker)</p>
<figure class="align-center" id="id5">
<a class="reference internal image-reference" href="../_images/contenedores.png"><img alt="Comparación entre arquitecturas" src="../_images/contenedores.png" style="width: 495.59999999999997px; height: 220.5px;" /></a>
<figcaption>
<p><span class="caption-text">Comparativa entre arquitectura de virtualización y contenedores</span><a class="headerlink" href="#id5" title="Enlace permanente a esta imagen"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="imagenes-y-procesos-docker">
<h2>Imágenes y procesos Docker<a class="headerlink" href="#imagenes-y-procesos-docker" title="Enlazar permanentemente con este título"></a></h2>
<p>En primer lugar hay que distinguir entre imágenes y contenedores.</p>
<ul class="simple">
<li><p>Una «imagen» contiene lo necesario para ejecutar un programa o servicio.</p></li>
<li><p>Un contenedor es una «imagen en marcha», como un proceso, y es la ejecución de una o más imágenes.</p></li>
</ul>
<p>Así, si por ejemplo tenemos una imagen que contenga, por ejemplo, el servidor web Apache podríamos lanzar muchísimas ejecuciones de esa imagen. Una vez que descargamos una imagen, dicha imagen se queda en el catálogo de Docker. Como puede verse, el concepto de «imagen» es muy similar al de «boxes» de Vagrant.</p>
<figure class="align-center" id="id6">
<a class="reference internal image-reference" href="../_images/ImagenesDocker.png"><img alt="Imágenes y procesos Docker" src="../_images/ImagenesDocker.png" style="width: 514.5px; height: 249.2px;" /></a>
<figcaption>
<p><span class="caption-text">Imágenes y procesos Docker</span><a class="headerlink" href="#id6" title="Enlace permanente a esta imagen"></a></p>
</figcaption>
</figure>
<section id="gestion-de-contenedores">
<h3>Gestión de contenedores<a class="headerlink" href="#gestion-de-contenedores" title="Enlazar permanentemente con este título"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">ps</span></code> : permite ver qué contenedores están activos.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">ps</span> <span class="pre">-a</span></code> : permite ver qué contenedores existen, estén activos o inactivos.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">stop</span> <span class="pre">&lt;identificador|nombre&gt;</span></code> : permite detener la ejecución de un programa en un contenedor. Se puede usar el identificador numérico asignado por Docker o el nombre que hayamos dado al contenedor.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">start</span> <span class="pre">&lt;identificador|nombre&gt;</span></code> : inicia un contenedor.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">restart</span> <span class="pre">&lt;identificador|nombre&gt;</span></code> : se asegura de detener primero el contenedor y despues arranca el contenedor.</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">create</span> <span class="pre">&lt;nombredeimagen&gt;</span></code><span class="classifier">hace varias cosas a la vez:</span></dt><dd><ul>
<li><p>Descarga la imagen en caso de que no esté en el repositorio local.</p></li>
<li><p>Crea el contenedor</p></li>
<li><p>Arranca su ejecución.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
</section>
<section id="los-elementos-basicos-de-docker">
<h2>Los elementos básicos de Docker<a class="headerlink" href="#los-elementos-basicos-de-docker" title="Enlazar permanentemente con este título"></a></h2>
<p>Docker permite tener por separado distintos elementos y combinarlos como queramos en un contenedor, estos elementos son:</p>
<ul class="simple">
<li><p>La consola de E/S: podemos conectar nuestra consola a la de un contenedor o no. Además podemos conectar solo la entrada, solo la salida o ambos.</p></li>
<li><p>La red: podremos crear redes virtuales y enganchar el contenedor que queramos a la red que queramos.</p></li>
<li><p>El almacenamiento: podemos crear discos virtuales y enganchar varios contenedores a un mismo disco o hacer que un contenedor tenga distintos discos.</p></li>
</ul>
<section id="la-consola-y-los-contenedores">
<h3>La consola y los contenedores<a class="headerlink" href="#la-consola-y-los-contenedores" title="Enlazar permanentemente con este título"></a></h3>
<p>Antes de examinar como funcionan las imágenes es importante comprender como funciona la E/S por consola. Nuestro sistema operativo tiene un <em>shell</em> (en Linux por defecto suele ser <code class="docutils literal notranslate"><span class="pre">bash</span></code>) pero ese <em>shell</em> <strong>no tiene absolutamente nada que ver con lo que hay dentro del contenedor</strong> . Si por ejemplo alguien mete un proceso que escriba simplemente «hola mundo» dentro de un contenedor y ejecutamos ese contenedor veremos la cadena, pero una vez impresa <strong>el contenedor se detiene</strong>.</p>
<ol class="arabic simple">
<li><p>Probemos a ejecutar <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">run</span> <span class="pre">dockerinaction/hello_world</span></code> . Veremos el mensaje «hello world».</p></li>
<li><p>Si volvemos a iniciar el contenedor (<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">start</span> <span class="pre">&lt;id&gt;</span></code> ) veremos que <strong>no aparece nada</strong>. Nuestra salida (lo que vemos en pantalla) no está conectada con la salida del contenedor.</p></li>
<li><p>Para que un contenedor conecte su salida con nuestra pantalla necesitamos la opción <code class="docutils literal notranslate"><span class="pre">--attach</span></code> o <code class="docutils literal notranslate"><span class="pre">-a</span></code> de esta manera <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">start</span> <span class="pre">-a</span> <span class="pre">&lt;id&gt;</span></code></p></li>
<li><p>De la misma manera, si queremos que el contenedor acepte entrada desde nuestro teclado deberemos usar <code class="docutils literal notranslate"><span class="pre">--interactive</span></code> o <code class="docutils literal notranslate"><span class="pre">-i</span></code> como por ejemplo <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">start</span> <span class="pre">-a</span> <span class="pre">-i</span> <span class="pre">&lt;id&gt;</span></code></p></li>
</ol>
<p>La pregunta lógica es <strong>¿por qué docker run sí muestra cosas en la consola pero docker start no lo hace</strong> . La respuesta es que <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">run</span></code> (que sabemos que equivale a ejecutar create+start) vincula por defecto la entrada y salida estándar del contenedor con nuestra consola y teclado. Sin embargo, <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">start</span></code> no hace nada de eso por defecto</p>
</section>
<section id="gestion-de-imagenes">
<h3>Gestión de imágenes<a class="headerlink" href="#gestion-de-imagenes" title="Enlazar permanentemente con este título"></a></h3>
<p>Algunas operaciones básicas son estas:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">images</span></code> : permite ver las imágenes que tenemos en nuestro repositorio local.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">pull</span> <span class="pre">&lt;nombreimagen&gt;</span></code> : permite descargar una imagen del registro de Docker, por ejemplo <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">pull</span> <span class="pre">mysql</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">rmi</span> <span class="pre">&lt;nombreimagen&gt;</span></code> : elimina una imagen de nuestro repositorio local.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>No se puede borrar una imagen de nuestro registro si algún contenedor la está usando. <code class="docutils literal notranslate"><span class="pre">Ni</span> <span class="pre">siquiera</span> <span class="pre">aunque</span> <span class="pre">el</span> <span class="pre">contenedor</span> <span class="pre">esté</span> <span class="pre">detenido.</span></code></p>
</div>
</section>
<section id="instalando-docker">
<h3>Instalando Docker<a class="headerlink" href="#instalando-docker" title="Enlazar permanentemente con este título"></a></h3>
<p>Ubuntu tiene su propio paquete Docker que puede instalarse usando <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">docker.io</span></code>, sin embargo podemos instalar la versión oficial en Linux añadiendo sus repositorios a la lista de repositorios de nuestro sistema. Para ello podemos usar estos comandos.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt-get remove docker docker-engine docker.io containerd runc
sudo apt-get update
sudo apt-get -y install apt-transport-https ca-certificates  curl  gnupg-agent software-properties-common
curl -fsSL https://download.docker.com/linux/ubuntu/gpg <span class="p">|</span> sudo apt-key add -
sudo add-apt-repository <span class="s2">&quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu </span><span class="k">$(</span>lsb_release -cs<span class="k">)</span><span class="s2"> stable&quot;</span>
sudo apt-get update
sudo apt-get -y install docker-ce docker-ce-cli containerd.io
</pre></div>
</div>
<p>Docker incluye un repositorio (que en Docker se llama registro) con imágenes de muchos servicios listos para descargar y ejecutarse simplemente usando scripts. Por ejemplo, ejecutemos un programa simple que se limita a saludar en pantalla con <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">run</span> <span class="pre">dockerinaction/hello_world</span></code> (Se dice que <code class="docutils literal notranslate"><span class="pre">dockerinaction</span></code> es un «espacio de nombres», en concreto es del autor de un libro llamado precisamente «Docker in action»).</p>
<p>El programa «se ha ejecutado dentro de un contenedor». Despues ha terminado y ha salido. Como programa es bastante simple, sin embargo, podemos ejecutar un Apache dentro de un contenedor con algo como esto (cuidado, si ya se tiene instalado Apache en Ubuntu esta ejecución fallará, se debe desinstalar primero). Si ejecutamos <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span> <span class="pre">httpd</span></code> veremos como Docker descarga e «instala una imagen de Apache».</p>
<p>En este último ejemplo no hemos puesto espacio de nombres, así que Docker asume que se debe buscar en los «repositorios oficiales de imágenes». Una vez ejecutado <strong>Apache se queda en ejecución y se «apodera» de la consola</strong> . Esto es normal, así que si queremos que el servidor Web se vaya a un segundo plano deberemos cerrar el programa (Ctrl-C) y ejecutar <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">run</span> <span class="pre">--detach</span> <span class="pre">httpd</span></code> o <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">run</span> <span class="pre">-d</span> <span class="pre">httpd</span></code> .</p>
<p>Podemos ver que Apache se está ejecutando en un contenedor con <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">ps</span></code> y «apagar» el contenedor con   <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">stop</span> <span class="pre">&lt;identificador&gt;</span></code> o incluso «terminarlo» <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">kill</span> <span class="pre">&lt;identificador&gt;</span></code> (no hace falta escribir todo el ID del container, basta con escribir las primeras letras).</p>
<p>También podemos reiniciar un servicio con <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">restart</span> <span class="pre">&lt;id_container&gt;</span></code> e incluso ver los logs del servicio con <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">logs</span> <span class="pre">&lt;id_container&gt;</span></code> .</p>
<p>Si queremos tener el mismo servicio para distintos clientes está claro que no podremos u    sar el mismo nombre, podemos lanzar un servicio con distintos nombres usando algo como <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">run</span> <span class="pre">-d</span> <span class="pre">--name</span> <span class="pre">ApacheCliente1</span> <span class="pre">httpd</span></code> lo que <strong>crea y ejecuta un contenedor llamado ApacheCliente1</strong> . Hay que recordar que aunque lo paremos no podremos volver a ejecutarlo con <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">run</span> <span class="pre">-d</span> <span class="pre">--name</span> <span class="pre">ApacheCliente1</span> <span class="pre">httpd</span></code> ya que eso <code class="docutils literal notranslate"><span class="pre">intentaría</span> <span class="pre">volver</span> <span class="pre">a</span> <span class="pre">crear</span> <span class="pre">el</span> <span class="pre">contenedor</span></code> (cosa imposible porque ya existe). Un contenedor puede volver a ejecutarse con <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">restart</span> <span class="pre">ApacheCliente1</span></code></p>
</section>
<section id="conexiones-de-red-en-docker">
<h3>Conexiones de red en Docker<a class="headerlink" href="#conexiones-de-red-en-docker" title="Enlazar permanentemente con este título"></a></h3>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>En clase usaremos Docker dentro de un VirtualBox, lo que nos complicará la gestión de servicios al tener que interactuar tanto con el subsistema de red de VirtualBox como con el subsistema de red de Docker.</p>
</div>
<p>Igual que VirtualBox , Docker tiene distintos modos de red, Docker ofrece tres «redes por defecto» con distintos comportamientos para los servicios alojados en él. En concreto existen estos tipos de redes (podemos ver los primeros con <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">network</span> <span class="pre">ls</span></code> :</p>
<ul class="simple">
<li><p>Bridge: Es el modo por defecto. Cualquier imagen que se ejecute en este modo puede ver a las otras imágenes que estén en ese host físico. Las direcciones por defecto son 172.16.0.0/16. Aunque se llama «bridge» se parece al modo NAT de VirtualBox.</p></li>
<li><p>Host: Se parecen al modo «puente» de VirtualBox. Un contenedor en modo «red host» no tiene su propio sistema de red, sino que usa el del host. <strong>A fecha de Noviembre de 2020 este sistema no funciona en Docker para Windows.</strong> Este sistema de red permite a los contenedores compartir la red del anfitrión.</p></li>
<li><p>Overlay: Está pensado para crear lo que Docker llama «enjambres», no los veremos en este tema, pero ofrecen mucha potencia al permitir crear redundancia y así tener servicios que tomen el trabajo de otros servidores caídos.</p></li>
<li><p>Macvlan: permiten asignar una MAC distinta a nuestro contenedores y obtener acceso total a la red. Aunque puede parecer que son iguales que las redes Docker en «modo host» en el 3modo host no podemos cambiar la MAC (cosa que sí podemos hacer siempre en VirtualBox).</p></li>
<li><p>None: permite deshabilitar la red de un contenedor.</p></li>
</ul>
</section>
<section id="creando-nuestra-propia-red-en-docker">
<h3>Creando nuestra propia red en Docker<a class="headerlink" href="#creando-nuestra-propia-red-en-docker" title="Enlazar permanentemente con este título"></a></h3>
<p>Podemos crear nuestra propia red para un grupo separado de servidores usando <a href="#id1"><span class="problematic" id="id2">``</span></a>sudo docker network create –driver bridge &lt;nombredered&gt; –subnet &lt;IP/Mascara&gt; `` . Docker creará una red separada con el prefijo IP que hayamos indicado. Por ejemplo, tecleemos esto:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">docker</span> <span class="n">network</span> <span class="n">create</span> <span class="o">--</span><span class="n">driver</span> <span class="n">bridge</span> <span class="n">red_clientes</span> <span class="o">--</span><span class="n">subnet</span> <span class="mf">172.30.20.0</span><span class="o">/</span><span class="mi">24</span>
</pre></div>
</div>
<p>Si deseamos trabajar con la red «host» en ese caso los contenedor <strong>no tienen su propia IP separada</strong>, es como si estuvieran ejecutándose en el host y entonces <strong>usaremos la ip del host</strong> En este tipo de redes no se crean redes de tipo <code class="docutils literal notranslate"><span class="pre">--driver</span> <span class="pre">host</span></code>. Solo hay una red de tipo host y cuando creemos el contenedor podremos indicar que su red es de tipo host.</p>
<p>Dicho esto, supongamos que queremos crear un contenedor que ejecute Apache y que vaya conectado a la nueva red llamada «red_clientes». El comando sería este:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">network</span> <span class="n">red_clientes</span> <span class="n">httpd</span>
</pre></div>
</div>
<p>Si ejecutamos este último comando veremos que Apache utiliza una IP de la red 172.30.20.0.</p>
<p>Cuando hayamos terminado de usar una red podemos borrarla con:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">docker</span> <span class="n">network</span> <span class="n">rm</span> <span class="o">&lt;</span><span class="n">nombre</span> <span class="n">o</span> <span class="nb">id</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Un detalle importante es que no podemos crear dos o más redes en las que las IP se solapen.</p>
</section>
<section id="ejercicios-de-redes-docker">
<h3>Ejercicios de redes Docker<a class="headerlink" href="#ejercicios-de-redes-docker" title="Enlazar permanentemente con este título"></a></h3>
<ol class="arabic simple">
<li><p>Crea una red de tipo «bridge» que use la dirección 192.168.16.0/24.</p></li>
<li><p>Crea una red de tipo «bridge» que use la dirección 10.0.20/24.</p></li>
<li><p>Crea una red de tipo «bridge» que use la dirección 10.161.0.0/16.</p></li>
<li><p>Crea una red de tipo «bridge» que use la dirección 172.84.128.0/18</p></li>
<li><p>Crea una red de tipo «bridge» que use la dirección 10.192.0.0/28</p></li>
<li><p>Crea una red de tipo «bridge» que use la dirección 192.168.65.128/26.</p></li>
</ol>
<p>Soluciones a los ejercicios</p>
<ol class="arabic">
<li><p>Crea una red de tipo «bridge» que use la dirección 192.168.16.0/24:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">docker</span> <span class="n">network</span> <span class="n">create</span> <span class="o">--</span><span class="n">driver</span> <span class="n">bridge</span> <span class="n">red_1</span> <span class="o">--</span><span class="n">subnet</span> <span class="mf">192.168.16.0</span><span class="o">/</span><span class="mi">24</span>
<span class="n">sudo</span> <span class="n">docker</span> <span class="n">network</span> <span class="n">inspect</span> <span class="n">red_1</span>
</pre></div>
</div>
</li>
<li><p>Crea una red de tipo «bridge» que use la dirección 10.0.20/24.:</p>
<blockquote>
<div><p>sudo docker network create –driver bridge red_2 –subnet 10.0.20/24
sudo docker network inspect red_2</p>
</div></blockquote>
</li>
<li><p>Crea una red de tipo «bridge» que use la dirección 10.161.0.0/16:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">docker</span> <span class="n">network</span> <span class="n">create</span> <span class="o">--</span><span class="n">driver</span> <span class="n">bridge</span> <span class="n">red_3</span> <span class="o">--</span><span class="n">subnet</span> <span class="mf">10.161.0.0</span><span class="o">/</span><span class="mi">16</span>
<span class="n">sudo</span> <span class="n">docker</span> <span class="n">network</span> <span class="n">inspect</span> <span class="n">red_3</span>
</pre></div>
</div>
</li>
<li><p>Crea una red de tipo «bridge» que use la dirección 172.17.84.0/18:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">docker</span> <span class="n">network</span> <span class="n">create</span> <span class="o">--</span><span class="n">driver</span> <span class="n">bridge</span> <span class="n">red_4</span> <span class="o">--</span><span class="n">subnet</span> <span class="mf">172.84.128.0</span><span class="o">/</span><span class="mi">18</span>
<span class="n">sudo</span> <span class="n">docker</span> <span class="n">network</span> <span class="n">inspect</span> <span class="n">red_4</span>
</pre></div>
</div>
</li>
<li><p>Crea una red de tipo «bridge» que use la dirección 10.192.0.0/28:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">docker</span> <span class="n">network</span> <span class="n">create</span> <span class="o">--</span><span class="n">driver</span> <span class="n">bridge</span> <span class="n">red_5</span> <span class="o">--</span><span class="n">subnet</span> <span class="mf">10.192.0.0</span><span class="o">/</span><span class="mi">28</span>
<span class="n">sudo</span> <span class="n">docker</span> <span class="n">network</span> <span class="n">inspect</span> <span class="n">red_5</span>
</pre></div>
</div>
</li>
<li><p>Crea una red de tipo «bridge» que use la dirección 192.168.65.128/26:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">docker</span> <span class="n">network</span> <span class="n">create</span> <span class="o">--</span><span class="n">driver</span> <span class="n">bridge</span> <span class="n">red_6</span> <span class="o">--</span><span class="n">subnet</span> <span class="mf">192.168.65.128</span><span class="o">/</span><span class="mi">26</span>
<span class="n">sudo</span> <span class="n">docker</span> <span class="n">network</span> <span class="n">inspect</span> <span class="n">red_6</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="almacenamiento-con-docker">
<h3>Almacenamiento con Docker<a class="headerlink" href="#almacenamiento-con-docker" title="Enlazar permanentemente con este título"></a></h3>
<p>En Docker podemos crear almacenamiento para los contenedores usando tres posibles elementos:</p>
<ul class="simple">
<li><p>Montaje de directorios (<em>bind mounts</em> en la terminología de Docker)</p></li>
<li><p>Almacenamiento en memoria.</p></li>
<li><p>Volúmenes.</p></li>
</ul>
</section>
<section id="montaje-de-directorios">
<h3>Montaje de directorios<a class="headerlink" href="#montaje-de-directorios" title="Enlazar permanentemente con este título"></a></h3>
<p>Esto consiste simplemente en conectar un directorio del «anfitrión» con otro directorio del contenedor Docker.</p>
</section>
<section id="un-ejemplo-simple-de-docker">
<h3>Un ejemplo simple de Docker<a class="headerlink" href="#un-ejemplo-simple-de-docker" title="Enlazar permanentemente con este título"></a></h3>
<p>Docker también se puede automatizar con fichero <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>FROM httpd
COPY index.html /usr/local/apache2/htdocs/index.html
EXPOSE <span class="m">80</span>
ENTRYPOINT <span class="o">[</span><span class="s2">&quot;apachectl&quot;</span>, <span class="s2">&quot;start&quot;</span><span class="o">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Construyamos una imagen con <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">build</span> <span class="pre">.</span> <span class="pre">-t</span> <span class="pre">ImagenPropia</span></code></p></li>
<li><p>Creemos un contenedor de prueba con <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">run</span> <span class="pre">-dti</span> <span class="pre">--name</span> <span class="pre">Servidor1</span> <span class="pre">ImagenPropia</span> <span class="pre">/bin/bash</span></code></p></li>
<li><p>Este contenedor ahora ejecuta Apache usando como HTML el fichero que le hayamos pasado.</p></li>
<li><p>Cuando queramos, podemos detener el contenedor y borrar con <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">stop</span> <span class="pre">Servidor1;</span> <span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">rm</span> <span class="pre">Servidor1</span></code></p></li>
</ul>
<p>Este ejemplo tan simple reconstruye un servidor Apache con el HTML que necesitemos.</p>
</section>
<section id="un-ejemplo-mas-avanzado-de-docker-usando-mysql">
<h3>Un ejemplo más avanzado de Docker usando MySQL<a class="headerlink" href="#un-ejemplo-mas-avanzado-de-docker-usando-mysql" title="Enlazar permanentemente con este título"></a></h3>
<p>En el ejemplo siguiente deseamos disponer de una pequeña base de datos almacenada dentro de un contenedor que ejecuta MySQL. En primer lugar, debemos saber que MySQL es una base de datos cliente/servidor y que dado que queremos ofrecer un conjunto de datos lo que haremos será usar una imagen Docker que ejecute el servidor MySQL con una base de datos como la siguiente:</p>
<ul class="simple">
<li><p>Nombre de la base de datos: ventas.</p></li>
<li><dl class="simple">
<dt>Tabla:</dt><dd><p>** Nombre: clientes.
** Campo dni, de tipo varchar(10) y clave primaria.
** Campo nombre, de tipo varchar(80).</p>
</dd>
</dl>
</li>
</ul>
<p>En la única tabla de esta base de datos almacenaremos estos dos clientes:</p>
<ul class="simple">
<li><p>Cliente 1, dni “5111222C” y nombre “Juan Ruiz”</p></li>
<li><p>Cliente 2, dni “5222333Z” y nombre “Carmen Diaz”</p></li>
</ul>
<p>En primer lugar, necesitamos el SQL que meteremos dentro del servidor y que nos construye esta base de datos, llamaremos a este fichero, por ejemplo <code class="docutils literal notranslate"><span class="pre">clientes.sql</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">use</span> <span class="n">ventas</span><span class="p">;</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">clientes</span> <span class="k">values</span> <span class="p">(</span><span class="s1">&#39;5111222C&#39;</span><span class="p">,</span> <span class="s1">&#39;Juan Ruiz&#39;</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">clientes</span> <span class="k">values</span> <span class="p">(</span><span class="s1">&#39;5222333Z&#39;</span><span class="p">,</span> <span class="s1">&#39;Carmen Diaz&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Como vemos estos datos se meten en una base de datos llamada «ventas». Sin embargo la base de datos, el usuario y la clave los indicaremos en el momento de la creación del contenedor.</p>
<p>Ahora creamos un fichero <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code> donde indicamos que usaremos MySQL, indicaremos como se llamará esta base de datos e indicaremos que nuestro script SQL debe ejecutarse al comienzo.</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">FROM</span> <span class="n">mysql</span>
<span class="no">ENV</span> <span class="no">MYSQL_DATABASE</span> <span class="n">ventas</span>
<span class="no">COPY</span> <span class="n">clientes</span><span class="o">.</span><span class="n">sql</span> <span class="sr">/docker-entrypoint-initdb.d/</span>
</pre></div>
</div>
<p>Con esto ya podemos preparar nuestra propia imagen que sirva nuestros datos. Podemos construirla con <code class="docutils literal notranslate"><span class="pre">`sudo</span> <span class="pre">docker</span> <span class="pre">build</span> <span class="pre">-t</span> <span class="pre">bdempresaacme</span> <span class="pre">.</span></code>.</p>
<p>Si ahora ejecutamos <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">images</span></code> podremos ver nuestra imagen. Una vez hecho esto ya podemos lanzar nuestro propio servicio de datos con <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">run</span> <span class="pre">-e</span> <span class="pre">MYSQL_ROOT_PASSWORD=clave1234</span> <span class="pre">-e</span> <span class="pre">MYSQL_USER=admin</span> <span class="pre">-e</span> <span class="pre">MYSQL_PASSWORD=1234</span></code>.</p>
<p>El comando anterior lanza el servidor de base de datos accesible solo en nuestro equipo (no hemos expuesto puertos ni nada por el estilo) y si queremos podemos consultar estos datos averiguando la ip de nuestro contenedor y usando un cliente como <code class="docutils literal notranslate"><span class="pre">mysql</span> <span class="pre">-u</span> <span class="pre">admin</span> <span class="pre">-h</span> <span class="pre">172.17.0.2</span> <span class="pre">-p</span></code>. Se nos preguntará la clave del usuario «admin» (hemos puesto arriba «1234») y podremos usarla.</p>
</section>
</section>
<section id="funcionamiento-ininterrumpido">
<h2>Funcionamiento ininterrumpido.<a class="headerlink" href="#funcionamiento-ininterrumpido" title="Enlazar permanentemente con este título"></a></h2>
</section>
<section id="integridad-de-datos-y-recuperacion-de-servicio">
<h2>Integridad de datos y recuperación de servicio.<a class="headerlink" href="#integridad-de-datos-y-recuperacion-de-servicio" title="Enlazar permanentemente con este título"></a></h2>
</section>
<section id="servidores-redundantes">
<h2>Servidores redundantes.<a class="headerlink" href="#servidores-redundantes" title="Enlazar permanentemente con este título"></a></h2>
</section>
<section id="sistemas-de-clusters">
<h2>Sistemas de  clusters.<a class="headerlink" href="#sistemas-de-clusters" title="Enlazar permanentemente con este título"></a></h2>
</section>
<section id="san-nas-fiberchannel">
<h2>SAN, NAS, FiberChannel<a class="headerlink" href="#san-nas-fiberchannel" title="Enlazar permanentemente con este título"></a></h2>
</section>
<section id="balanceadores-de-carga">
<h2>Balanceadores de carga.<a class="headerlink" href="#balanceadores-de-carga" title="Enlazar permanentemente con este título"></a></h2>
</section>
<section id="instalacion-y-configuracion-de-soluciones-de-alta-disponibilidad">
<h2>Instalación y configuración de soluciones de alta disponibilidad.<a class="headerlink" href="#instalacion-y-configuracion-de-soluciones-de-alta-disponibilidad" title="Enlazar permanentemente con este título"></a></h2>
</section>
</section>
<section id="ejercicio-recuperando-una-web-con-vagrant">
<h1>Ejercicio: recuperando una web con Vagrant<a class="headerlink" href="#ejercicio-recuperando-una-web-con-vagrant" title="Enlazar permanentemente con este título"></a></h1>
<p>Una empresa desea poder recuperar su sitio web con rapidez, por lo que ha decidido intentar automatizar la recuperación con Vagrant. Su web tiene un solo archivo, llamado <code class="docutils literal notranslate"><span class="pre">index.html</span></code> y su contenido es el siguiente:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Empresa ACME<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Bienvenido<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
            Esta es la web de la empresa ACME
        <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>En concreto se ha pensado en tener una máquina virtualizada con una tarjeta en modo NAT. Se desea que cuando alguien se conecte a la IP del anfitrión y puerto 80 se redirija la conexión al interior de la máquina virtual (también a su puerto 80) pero por supuesto se desea que se vea la web de la empresa y no el archivo <code class="docutils literal notranslate"><span class="pre">index.html</span></code> que suele mostrar Apache sobre Ubuntu.</p>
<section id="solucion-a-la-recuperacion-de-la-web">
<h2>Solución a la recuperación de la web<a class="headerlink" href="#solucion-a-la-recuperacion-de-la-web" title="Enlazar permanentemente con este título"></a></h2>
<ul class="simple">
<li><p>Sabemos que podemos instalar Apache en la máquina virtual recuperada usando los scripts de aprovisionamiento.</p></li>
<li><p>Sabemos que Apache tiene un directorio <code class="docutils literal notranslate"><span class="pre">/var/www/html</span></code> . En dicho directorio se deben poner los archivos de web.</p></li>
<li><p>Sabemos que el archivo de la empresa está en <code class="docutils literal notranslate"><span class="pre">C:\Users\admin\Documents\index.html</span></code></p></li>
</ul>
<p>Teniendo eso en mente podemos hacer lo siguiente:</p>
<p>En primer lugar usamos <code class="docutils literal notranslate"><span class="pre">vagrant</span> <span class="pre">init</span> <span class="pre">e:/maquinas/UbuntuServerBase.box</span></code> . Esto nos creará un fichero <code class="docutils literal notranslate"><span class="pre">Vagrantfile</span></code>. Si lo editamos podremos poner en él éstas líneas (se han omitido partes no relevantes):</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
<span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;e:/maquinas/UbuntuServerBase.box&quot;</span>
<span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;forwarded_port&quot;</span><span class="p">,</span> <span class="ss">guest</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="ss">host</span><span class="p">:</span> <span class="mi">80</span>
<span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">synced_folder</span> <span class="s2">&quot;e:/directorio_auxiliar&quot;</span><span class="p">,</span> <span class="s2">&quot;/var/www/html&quot;</span>
<span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&quot;shell&quot;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="o">&lt;&lt;-</span><span class="dl">SHELL</span>
<span class="sh">    systemctl disable apt-daily.timer</span>
<span class="sh">        systemctl disable apt-daily.service</span>
<span class="sh">    apt-get update</span>
<span class="sh">    apt-get install -y apache2</span>
<span class="dl">SHELL</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Con esto, recuperamos la máquina, instalamos Apache y sobre todo <strong>conectamos el directorio del Apache virtualizado con un directorio del anfitrión donde están los archivos web.</strong></p>
<p>Una vez hecho esto, podemos crear un fichero .BAT <strong>que copie el HTML de la web al directorio auxiliar</strong> . Si tenemos el <code class="docutils literal notranslate"><span class="pre">Vagrantfile</span></code> y este fichero .BAT podremos recuperar la web con toda comodidad</p>
<div class="highlight-BAT notranslate"><div class="highlight"><pre><span></span>vagrant up
<span class="k">copy</span> C:\Users\admin\Documents\index.html e:/directorio_auxiliar
</pre></div>
</div>
</section>
<section id="solucion-al-ejercicio-de-alojar-una-base-de-datos-en-docker">
<h2>Solución al ejercicio de alojar una base de datos en Docker<a class="headerlink" href="#solucion-al-ejercicio-de-alojar-una-base-de-datos-en-docker" title="Enlazar permanentemente con este título"></a></h2>
<p>En primer lugar se necesita el fichero SQL, que también mostramos aquí:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">drop</span> <span class="k">database</span> <span class="n">proyectos</span><span class="p">;</span>
<span class="k">create</span> <span class="k">database</span> <span class="n">proyectos</span><span class="p">;</span>

<span class="n">use</span> <span class="n">proyectos</span><span class="p">;</span>

<span class="k">create</span> <span class="k">table</span> <span class="n">proveedores</span> <span class="p">(</span>
    <span class="n">numprov</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
    <span class="n">nombreprov</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
    <span class="n">estado</span> <span class="n">tinyint</span><span class="p">,</span>
    <span class="n">ciudad</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="p">)</span> <span class="p">;</span>

<span class="k">create</span> <span class="k">table</span> <span class="n">partes</span> <span class="p">(</span>
<span class="n">numparte</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
<span class="n">nombreparte</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>
<span class="n">color</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
<span class="n">peso</span> <span class="n">tinyint</span><span class="p">,</span>
<span class="n">ciudad</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">create</span> <span class="k">table</span> <span class="n">proyectos</span> <span class="p">(</span>
<span class="n">numproyecto</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
<span class="n">nombreproyecto</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">13</span><span class="p">),</span>
<span class="n">ciudad</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="p">);</span>


<span class="k">create</span> <span class="k">table</span> <span class="n">suministra</span> <span class="p">(</span>
<span class="n">numprov</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">references</span> <span class="n">proveedores</span><span class="p">(</span><span class="n">numprov</span><span class="p">),</span>
<span class="n">numparte</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">references</span> <span class="n">partes</span><span class="p">(</span><span class="n">numparte</span><span class="p">),</span>
<span class="n">numproyecto</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">references</span> <span class="n">proyectos</span><span class="p">(</span><span class="n">numproyecto</span><span class="p">),</span>
<span class="n">cantidad</span> <span class="nb">int</span><span class="p">,</span>
<span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">numprov</span><span class="p">,</span><span class="n">numparte</span><span class="p">,</span> <span class="n">numproyecto</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">insert</span> <span class="k">into</span> <span class="n">proveedores</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v1&quot;</span><span class="p">,</span> <span class="ss">&quot;Smith&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="ss">&quot;Londres&quot;</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">proveedores</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v2&quot;</span><span class="p">,</span> <span class="ss">&quot;Jones&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="ss">&quot;Paris&quot;</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">proveedores</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v3&quot;</span><span class="p">,</span> <span class="ss">&quot;Blake&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="ss">&quot;Paris&quot;</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">proveedores</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v4&quot;</span><span class="p">,</span> <span class="ss">&quot;Clarke&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="ss">&quot;Londres&quot;</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">proveedores</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v5&quot;</span><span class="p">,</span> <span class="ss">&quot;Adams&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="ss">&quot;Atenas&quot;</span><span class="p">);</span>

<span class="k">insert</span> <span class="k">into</span> <span class="n">partes</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;p1&quot;</span><span class="p">,</span> <span class="ss">&quot;Tuerca&quot;</span><span class="p">,</span>  <span class="ss">&quot;Rojo&quot;</span><span class="p">,</span> <span class="ss">&quot;12&quot;</span><span class="p">,</span> <span class="ss">&quot;Londres&quot;</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">partes</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;p2&quot;</span><span class="p">,</span> <span class="ss">&quot;Perno&quot;</span><span class="p">,</span>   <span class="ss">&quot;Verde&quot;</span><span class="p">,</span> <span class="ss">&quot;17&quot;</span><span class="p">,</span> <span class="ss">&quot;Paris&quot;</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">partes</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;p3&quot;</span><span class="p">,</span> <span class="ss">&quot;Tornillo&quot;</span><span class="p">,</span><span class="ss">&quot;Azul&quot;</span><span class="p">,</span> <span class="ss">&quot;17&quot;</span><span class="p">,</span> <span class="ss">&quot;Roma&quot;</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">partes</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;p4&quot;</span><span class="p">,</span> <span class="ss">&quot;Tornillo&quot;</span><span class="p">,</span><span class="ss">&quot;Rojo&quot;</span><span class="p">,</span> <span class="ss">&quot;14&quot;</span><span class="p">,</span> <span class="ss">&quot;Londres&quot;</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">partes</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;p5&quot;</span><span class="p">,</span> <span class="ss">&quot;Leva&quot;</span><span class="p">,</span>    <span class="ss">&quot;Azul&quot;</span><span class="p">,</span> <span class="ss">&quot;12&quot;</span><span class="p">,</span> <span class="ss">&quot;Paris&quot;</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">partes</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;p6&quot;</span><span class="p">,</span> <span class="ss">&quot;Engranaje&quot;</span><span class="p">,</span> <span class="ss">&quot;Rojo&quot;</span><span class="p">,</span> <span class="ss">&quot;19&quot;</span><span class="p">,</span> <span class="ss">&quot;Londres&quot;</span><span class="p">);</span>

<span class="k">insert</span> <span class="k">into</span> <span class="n">proyectos</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;y1&quot;</span><span class="p">,</span> <span class="ss">&quot;Clasificador&quot;</span><span class="p">,</span> <span class="ss">&quot;Paris&quot;</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">proyectos</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;y2&quot;</span><span class="p">,</span> <span class="ss">&quot;Monitor&quot;</span><span class="p">,</span> <span class="ss">&quot;Roma&quot;</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">proyectos</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;y3&quot;</span><span class="p">,</span> <span class="ss">&quot;OCR&quot;</span><span class="p">,</span> <span class="ss">&quot;Atenas&quot;</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">proyectos</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;y4&quot;</span><span class="p">,</span> <span class="ss">&quot;Consola&quot;</span><span class="p">,</span> <span class="ss">&quot;Atenas&quot;</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">proyectos</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;y5&quot;</span><span class="p">,</span> <span class="ss">&quot;RAID&quot;</span><span class="p">,</span> <span class="ss">&quot;Londres&quot;</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">proyectos</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;y6&quot;</span><span class="p">,</span> <span class="ss">&quot;EDS&quot;</span><span class="p">,</span> <span class="ss">&quot;Oslo&quot;</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">proyectos</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;y7&quot;</span><span class="p">,</span> <span class="ss">&quot;Cinta&quot;</span><span class="p">,</span> <span class="ss">&quot;Londres&quot;</span><span class="p">);</span>


<span class="k">insert</span> <span class="k">into</span> <span class="n">suministra</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v1&quot;</span><span class="p">,</span> <span class="ss">&quot;p1&quot;</span><span class="p">,</span> <span class="ss">&quot;y1&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">suministra</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v1&quot;</span><span class="p">,</span> <span class="ss">&quot;p1&quot;</span><span class="p">,</span> <span class="ss">&quot;y4&quot;</span><span class="p">,</span> <span class="mi">700</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">suministra</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v2&quot;</span><span class="p">,</span> <span class="ss">&quot;p3&quot;</span><span class="p">,</span> <span class="ss">&quot;y1&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">suministra</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v2&quot;</span><span class="p">,</span> <span class="ss">&quot;p3&quot;</span><span class="p">,</span> <span class="ss">&quot;y2&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">suministra</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v2&quot;</span><span class="p">,</span> <span class="ss">&quot;p3&quot;</span><span class="p">,</span> <span class="ss">&quot;y3&quot;</span><span class="p">,</span> <span class="mi">300</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">suministra</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v2&quot;</span><span class="p">,</span> <span class="ss">&quot;p3&quot;</span><span class="p">,</span> <span class="ss">&quot;y4&quot;</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">suministra</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v2&quot;</span><span class="p">,</span> <span class="ss">&quot;p3&quot;</span><span class="p">,</span> <span class="ss">&quot;y5&quot;</span><span class="p">,</span> <span class="mi">600</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">suministra</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v2&quot;</span><span class="p">,</span> <span class="ss">&quot;p3&quot;</span><span class="p">,</span> <span class="ss">&quot;y6&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">suministra</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v2&quot;</span><span class="p">,</span> <span class="ss">&quot;p3&quot;</span><span class="p">,</span> <span class="ss">&quot;y7&quot;</span><span class="p">,</span> <span class="mi">600</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">suministra</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v2&quot;</span><span class="p">,</span> <span class="ss">&quot;p5&quot;</span><span class="p">,</span> <span class="ss">&quot;y2&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">suministra</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v3&quot;</span><span class="p">,</span> <span class="ss">&quot;p3&quot;</span><span class="p">,</span> <span class="ss">&quot;y1&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">suministra</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v3&quot;</span><span class="p">,</span> <span class="ss">&quot;p4&quot;</span><span class="p">,</span> <span class="ss">&quot;y2&quot;</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">suministra</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v4&quot;</span><span class="p">,</span> <span class="ss">&quot;p6&quot;</span><span class="p">,</span> <span class="ss">&quot;y3&quot;</span><span class="p">,</span> <span class="mi">300</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">suministra</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v4&quot;</span><span class="p">,</span> <span class="ss">&quot;p6&quot;</span><span class="p">,</span> <span class="ss">&quot;y7&quot;</span><span class="p">,</span> <span class="mi">300</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">suministra</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v5&quot;</span><span class="p">,</span> <span class="ss">&quot;p2&quot;</span><span class="p">,</span> <span class="ss">&quot;y2&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">suministra</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v5&quot;</span><span class="p">,</span> <span class="ss">&quot;p2&quot;</span><span class="p">,</span> <span class="ss">&quot;y4&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">suministra</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v5&quot;</span><span class="p">,</span> <span class="ss">&quot;p5&quot;</span><span class="p">,</span> <span class="ss">&quot;y5&quot;</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">suministra</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v5&quot;</span><span class="p">,</span> <span class="ss">&quot;p6&quot;</span><span class="p">,</span> <span class="ss">&quot;y2&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">suministra</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v5&quot;</span><span class="p">,</span> <span class="ss">&quot;p1&quot;</span><span class="p">,</span> <span class="ss">&quot;y4&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">suministra</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v5&quot;</span><span class="p">,</span> <span class="ss">&quot;p3&quot;</span><span class="p">,</span> <span class="ss">&quot;y4&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">suministra</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v5&quot;</span><span class="p">,</span> <span class="ss">&quot;p4&quot;</span><span class="p">,</span> <span class="ss">&quot;y4&quot;</span><span class="p">,</span> <span class="mi">800</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">suministra</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v5&quot;</span><span class="p">,</span> <span class="ss">&quot;p5&quot;</span><span class="p">,</span> <span class="ss">&quot;y4&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">suministra</span> <span class="k">values</span> <span class="p">(</span><span class="ss">&quot;v5&quot;</span><span class="p">,</span> <span class="ss">&quot;p6&quot;</span><span class="p">,</span> <span class="ss">&quot;y4&quot;</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pie de página">
        <a href="../tema_cortafuegos/tema_cortafuegos.html" class="btn btn-neutral float-left" title="Instalación y configuración de cortafuegos" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
        <a href="../tema_proxys/tema_proxys.html" class="btn btn-neutral float-right" title="Instalación y configuración de servidores proxy" accesskey="n" rel="next">Siguiente <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Derechos de autor 2019, Oscar GG.</p>
  </div>

  Compilado con <a href="https://www.sphinx-doc.org/">Sphinx</a> usando un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">tema</a>
    proporcionado por <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>